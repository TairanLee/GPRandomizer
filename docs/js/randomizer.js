/*! Copyright (c) Takuro Goto (sopra) | MIT License */
const GPRandomizer={};GPRandomizer.Menu=function(){let e="pNumbers";return{players:function(t){return t&&t>1&&t<5&&(document.getElementById(e).value=t),document.getElementById(e).value}}}(),GPRandomizer.BoardState={players:"",federation:"",advancedTechs:[],basicTechs:[],roundScores:[],finalScores:[],roundBoosters:[],map:[],toHashbangString:function(){return"#!"+["PLAYERS="+this.players,"FED="+this.federation,"ADV="+this.advancedTechs.join(","),"BAS="+this.basicTechs.join(","),"RND="+this.roundScores.join(","),"FIN="+this.finalScores.join(","),"BOO="+this.roundBoosters.join(","),"MAP="+this.map.join(",")].join("&")},clearBoardState:function(){this.players="",this.federation="",this.advancedTechs=[],this.basicTechs=[],this.roundScores=[],this.finalScores=[],this.roundBoosters=[],this.map=[]}},GPRandomizer.Map={boardId:"map",setPreset:function(e){},generatePresetMap:function(e){},generateRandomMap:function(e){},resizeMapVerticalGridLength:function(){let e=document.getElementById(this.boardId),t=e.clientWidth/20/2;e.style.gridTemplateRows=(t+"px ").repeat(30),e.style.setProperty("-ms-grid-rows",(t+"px").repeat(30))}},window.addEventListener("load",function(){const e=navigator.userAgent,t=e.match(/Chrome|Opera/)&&-1==e.indexOf("Edge")?".webp":"-min.png",n=["pic/FEDcre"+t,"pic/FEDknw"+t,"pic/FEDore"+t,"pic/FEDpwt"+t,"pic/FEDqic"+t,"pic/FEDvps"+t],i=["pic/RNDfed"+t,"pic/RNDgai3"+t,"pic/RNDgai4"+t,"pic/RNDmin"+t,"pic/RNDpia"+t,"pic/RNDstp"+t,"pic/RNDter"+t,"pic/RNDtrs3"+t,"pic/RNDtrs4"+t],r=["pic/TECcre"+t,"pic/TECgai"+t,"pic/TECknw"+t,"pic/TECore"+t,"pic/TECpia"+t,"pic/TECpow"+t,"pic/TECqic"+t,"pic/TECtyp"+t,"pic/TECvps"+t],a=["pic/ADVfedP"+t,"pic/ADVfedV"+t,"pic/ADVgai"+t,"pic/ADVknw"+t,"pic/ADVlab"+t,"pic/ADVminB"+t,"pic/ADVminV"+t,"pic/ADVore"+t,"pic/ADVqic"+t,"pic/ADVsecO"+t,"pic/ADVsecV"+t,"pic/ADVstp"+t,"pic/ADVtrsB"+t,"pic/ADVtrsV"+t,"pic/ADVtyp"+t],o=["pic/BOOgai"+t,"pic/BOOknw"+t,"pic/BOOlab"+t,"pic/BOOmin"+t,"pic/BOOnav"+t,"pic/BOOpia"+t,"pic/BOOpwt"+t,"pic/BOOqic"+t,"pic/BOOter"+t,"pic/BOOtrs"+t],c=["pic/FINbld"+t,"pic/FINfed"+t,"pic/FINgai"+t,"pic/FINsat"+t,"pic/FINsec"+t,"pic/FINtyp"+t],s={4:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t,"pic/9"+t,"pic/10"+t],3:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t],2:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5_"+t,"pic/6_"+t,"pic/7_"+t]};function p(e,t){if(t&&t.length>0)return t.map(function(t){return e[t]});let n=[].concat(e);for(var i,r,a=n.length;a;)r=Math.floor(Math.random()*a--),i=n[a],n[a]=n[r],n[r]=i;return n}function d(e,t){let n,i;!function(){if(!document.querySelector("[data-map-css]")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/map.css"),e.setAttribute("data-map-css",""),document.getElementsByTagName("head")[0].appendChild(e)}}(),GPRandomizer.Map.resizeMapVerticalGridLength();let r={2:[2,6,9],3:[2,6],4:[]};if(t){let e=t.split(",");n=e.filter(function(e,t){return t%2==0}),i=e.filter(function(e,t){return t%2==1})}let a=p(s[e],n);Array.prototype.forEach.call(document.querySelectorAll('img[data-generator-type="map"]'),function(t,n){if(t.parentElement.className="mapItem mapTile"+n+"-"+e+"er",-1!=r[e].indexOf(n))return!0;let o=60*Math.floor(6*Math.random()),c=a.shift();i&&(o=i.shift()),t.setAttribute("src",c),t.setAttribute("data-map-index",n),t.style.transform="rotate("+o+"deg)",GPRandomizer.BoardState.map.push(s[e].indexOf(c),o)})}function l(e){var t,s,l={};1==e&&location.hash&&(l=function(e){for(var t=e.slice(e.indexOf("#!")+2).split("&"),n={},i=0;i<t.length;i++){var r=t[i].split("=");r.length>1?n[r[0]]=r[1]:n[r[0]]=null}return n}(location.hash)),GPRandomizer.BoardState.clearBoardState(),l.PLAYERS&&GPRandomizer.Menu.players(l.PLAYERS),GPRandomizer.BoardState.players=GPRandomizer.Menu.players(),t=l.FED,s=0,s=t||Math.floor(Math.random()*n.length),document.getElementById("FED").setAttribute("src",n[s]),GPRandomizer.BoardState.federation=s,function(e){var t=e?e.split(","):[],n=p(a,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="adv"]'),function(e,t){e.setAttribute("src",n[t]),GPRandomizer.BoardState.advancedTechs.push(a.indexOf(n[t]))})}(l.ADV),function(e){var t=e?e.split(","):[],n=p(r,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="bas"]'),function(e,t){e.setAttribute("src",n[t]),GPRandomizer.BoardState.basicTechs.push(r.indexOf(n[t]))})}(l.BAS),function(e){let t=e?e.split(","):[],n=p(i,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="rnd"]'),function(e,t){e.setAttribute("src",n[t]),GPRandomizer.BoardState.roundScores.push(i.indexOf(n[t]))})}(l.RND),function(e){let t=e?e.split(","):[],n=p(c,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="fin"]'),function(e,t){e.setAttribute("src",n[t]),GPRandomizer.BoardState.finalScores.push(c.indexOf(n[t]))})}(l.FIN),function(e){let t=e?e.split(","):[],n=document.getElementById("booster"),i=Number(GPRandomizer.Menu.players()),r=i+3,a=p(o,t);n.style.setProperty("grid-template-columns","1fr ".repeat(r)),n.style.setProperty("-ms-grid-columns","1fr ".repeat(r)),Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="boo"]'),function(e,t){if(r<=t)return e.parentElement.style.display="none",!0;e.parentElement.style.setProperty("-ms-grid-column",t+1),e.parentElement.style.display="block",e.parentElement.className="booster booster"+i+"er",e.setAttribute("src",a[t]),GPRandomizer.BoardState.roundBoosters.push(o.indexOf(a[t]))})}(l.BOO),l.MAP&&d(GPRandomizer.Menu.players(),l.MAP)}function m(e){e.stopPropagation();let t=this.style.transform.match(/rotate\(([0-9]+)deg\)/),n=60,i=this.getAttribute("data-map-index");t&&(n=Number(t[1])+60)>=360&&(n-=360),this.style.transform="rotate("+n+"deg)",GPRandomizer.BoardState.map[2*i]=n}document.getElementById("setup").addEventListener("click",function(){l()}),document.getElementById("hide").addEventListener("click",function(){let e=document.getElementsByTagName("menu")[0],t=document.getElementById("mapGenMenu");e.style.display="none",t.style.display="none";var n=document.getElementsByTagName("main")[0].addEventListener("click",function(){e.style.display="block",t.style.display="block",document.getElementsByTagName("main")[0].removeEventListener("click",n)})}),document.getElementById("permalink").addEventListener("click",function(){let e=location.origin+location.pathname+GPRandomizer.BoardState.toHashbangString();window.history&&window.history.pushState(null,null,e),function(){let t=document.createElement("pre");t.style.display="inline-block",t.style.width=0,t.style.height=0,t.innerText=e,document.querySelector("div.header").appendChild(t);let n=document.createRange();n.selectNode(t),window.getSelection().addRange(n),document.execCommand("copy"),document.querySelector("div.header").removeChild(t),alert("Copy permalink to clipboard")}()}),document.getElementById("mapGen").addEventListener("click",function(){d(GPRandomizer.Menu.players())}),Array.prototype.forEach.call(document.querySelectorAll("div.mapItem > img"),function(e){e.addEventListener("click",m)});let u,y,h,f,g,E=null;window.addEventListener("resize",function(){clearTimeout(E),E=setTimeout(function(){GPRandomizer.Map.resizeMapVerticalGridLength()},300)}),document.getElementById("mineGen").addEventListener("click",function(e){function t(e){let t=e;"mousemove"!==e.type&&(t=e.changedTouches[0]),u.style.top=g+(t.pageY-h)+"px",u.style.left=f+(t.pageX-y)+"px"}let n,i=document.createElement("img"),r=!1,a=0,o=["pic/blue_mine.svg","pic/red_mine.svg","pic/orange_mine.svg","pic/yello_mine.svg","pic/brown_mine.svg","pic/gray_mine.svg","pic/white_mine.svg"];function c(e){e.preventDefault(),e.stopPropagation(),u=i,"mousedown"==e.type?(y=e.pageX,h=e.pageY):(y=e.changedTouches[0].pageX,h=e.changedTouches[0].pageY),f=Number(u.style.left.replace(/px/,"")),g=Number(u.style.top.replace(/px/,"")),n=setTimeout(function(){r=!0,document.addEventListener("mousemove",t),document.addEventListener("touchmove",t)},100)}function s(e){clearTimeout(n),!1===r&&(++a>=o.length&&(a=0),u.setAttribute("src",o[a])),r=!1,document.removeEventListener("mousemove",t),document.removeEventListener("touchmove",t)}i.setAttribute("src",o[a]),i.style.position="relative",i.style.width=document.getElementById("map").clientWidth/20/1.5+"px",i.style.top="0px",i.style.left="0px",i.style.msGridColumn="1",i.style.msGridRow="1",i.style.gridColumn="1",i.style.gridRow="1",document.getElementById("map").appendChild(i),i.addEventListener("mousedown",c),i.addEventListener("touchstart",c,{passive:!1}),i.addEventListener("mouseup",s),i.addEventListener("touchend",s)}),l(!0)});