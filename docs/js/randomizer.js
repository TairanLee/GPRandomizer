/*! Copyright (c) Takuro Goto (sopra) | MIT License */
const GPRandomizer={};GPRandomizer.Menu=function(){let e="pNumbers";return{players:function(t){return t&&t>1&&t<5&&(document.getElementById(e).value=t),document.getElementById(e).value}}}(),GPRandomizer.BoardState={players:"",federation:"",advancedTechs:[],basicTechs:[],roundScores:[],finalScores:[],roundBoosters:[],map:[],toHashbangString:function(){return"#!"+["PLAYERS="+this.players,"FED="+this.federation,"ADV="+this.advancedTechs.join(","),"BAS="+this.basicTechs.join(","),"RND="+this.roundScores.join(","),"FIN="+this.finalScores.join(","),"BOO="+this.roundBoosters.join(","),"MAP="+this.map.join(",")].join("&")},clearBoardState:function(){this.players="",this.federation="",this.advancedTechs=[],this.basicTechs=[],this.roundScores=[],this.finalScores=[],this.roundBoosters=[],this.map=[]}},GPRandomizer.Map={boardId:"map",setPreset:function(e){},generatePresetMap:function(e){},generateRandomMap:function(e){},resizeMapVerticalGridLength:function(){let e=document.getElementById(this.boardId),t=e.clientWidth/20/2;e.style.gridTemplateRows=(t+"px ").repeat(30),e.style.setProperty("-ms-grid-rows",(t+"px").repeat(30))}},window.addEventListener("load",function(){const e=navigator.userAgent,t=e.match(/Chrome|Opera/)&&-1==e.indexOf("Edge")?".webp":"-min.png",i=["pic/FEDcre"+t,"pic/FEDknw"+t,"pic/FEDore"+t,"pic/FEDpwt"+t,"pic/FEDqic"+t,"pic/FEDvps"+t],n=["pic/RNDfed"+t,"pic/RNDgai3"+t,"pic/RNDgai4"+t,"pic/RNDmin"+t,"pic/RNDpia"+t,"pic/RNDstp"+t,"pic/RNDter"+t,"pic/RNDtrs3"+t,"pic/RNDtrs4"+t],r=["pic/TECcre"+t,"pic/TECgai"+t,"pic/TECknw"+t,"pic/TECore"+t,"pic/TECpia"+t,"pic/TECpow"+t,"pic/TECqic"+t,"pic/TECtyp"+t,"pic/TECvps"+t],a=["pic/ADVfedP"+t,"pic/ADVfedV"+t,"pic/ADVgai"+t,"pic/ADVknw"+t,"pic/ADVlab"+t,"pic/ADVminB"+t,"pic/ADVminV"+t,"pic/ADVore"+t,"pic/ADVqic"+t,"pic/ADVsecO"+t,"pic/ADVsecV"+t,"pic/ADVstp"+t,"pic/ADVtrsB"+t,"pic/ADVtrsV"+t,"pic/ADVtyp"+t],c=["pic/BOOgai"+t,"pic/BOOknw"+t,"pic/BOOlab"+t,"pic/BOOmin"+t,"pic/BOOnav"+t,"pic/BOOpia"+t,"pic/BOOpwt"+t,"pic/BOOqic"+t,"pic/BOOter"+t,"pic/BOOtrs"+t],o=["pic/FINbld"+t,"pic/FINfed"+t,"pic/FINgai"+t,"pic/FINsat"+t,"pic/FINsec"+t,"pic/FINtyp"+t],p={4:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t,"pic/9"+t,"pic/10"+t],3:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t],2:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5_"+t,"pic/6_"+t,"pic/7_"+t]};function s(e,t){if(t&&t.length>0)return t.map(function(t){return e[t]});let i=[].concat(e);for(var n,r,a=i.length;a;)r=Math.floor(Math.random()*a--),n=i[a],i[a]=i[r],i[r]=n;return i}function l(e,t){let i,n;!function(){if(!document.querySelector("[data-map-css]")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/map.css"),e.setAttribute("data-map-css",""),document.getElementsByTagName("head")[0].appendChild(e)}}(),GPRandomizer.Map.resizeMapVerticalGridLength();let r={2:[2,6,9],3:[2,6],4:[]};if(t){let e=t.split(",");i=e.filter(function(e,t){return t%2==0}),n=e.filter(function(e,t){return t%2==1})}let a=s(p[e],i);Array.prototype.forEach.call(document.querySelectorAll('img[data-generator-type="map"]'),function(t,i){if(t.parentElement.className="mapItem mapTile"+i+"-"+e+"er",-1!=r[e].indexOf(i))return!0;let c=60*Math.floor(6*Math.random()),o=a.shift();n&&(c=n.shift()),t.setAttribute("src",o),t.setAttribute("data-map-index",i),t.style.transform="rotate("+c+"deg)",GPRandomizer.BoardState.map.push(p[e].indexOf(o),c)})}function d(e){var t,p,d={};1==e&&location.hash&&(d=function(e){for(var t=e.slice(e.indexOf("#!")+2).split("&"),i={},n=0;n<t.length;n++){var r=t[n].split("=");r.length>1?i[r[0]]=r[1]:i[r[0]]=null}return i}(location.hash)),GPRandomizer.BoardState.clearBoardState(),d.PLAYERS&&GPRandomizer.Menu.players(d.PLAYERS),GPRandomizer.BoardState.players=GPRandomizer.Menu.players(),t=d.FED,p=0,p=t||Math.floor(Math.random()*i.length),document.getElementById("FED").setAttribute("src",i[p]),GPRandomizer.BoardState.federation=p,function(e){var t=e?e.split(","):[],i=s(a,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="adv"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.advancedTechs.push(a.indexOf(i[t]))})}(d.ADV),function(e){var t=e?e.split(","):[],i=s(r,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="bas"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.basicTechs.push(r.indexOf(i[t]))})}(d.BAS),function(e){let t=e?e.split(","):[],i=s(n,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="rnd"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.roundScores.push(n.indexOf(i[t]))})}(d.RND),function(e){let t=e?e.split(","):[],i=s(o,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="fin"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.finalScores.push(o.indexOf(i[t]))})}(d.FIN),function(e){let t=e?e.split(","):[],i=document.getElementById("booster"),n=Number(GPRandomizer.Menu.players()),r=n+3,a=s(c,t);i.style.setProperty("grid-template-columns","1fr ".repeat(r)),i.style.setProperty("-ms-grid-columns","1fr ".repeat(r)),Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="boo"]'),function(e,t){if(r<=t)return e.parentElement.style.display="none",!0;e.parentElement.style.setProperty("-ms-grid-column",t+1),e.parentElement.style.display="block",e.parentElement.className="booster booster"+n+"er",e.setAttribute("src",a[t]),GPRandomizer.BoardState.roundBoosters.push(c.indexOf(a[t]))})}(d.BOO),d.MAP&&l(GPRandomizer.Menu.players(),d.MAP)}function u(e){e.stopPropagation();let t=this.style.transform.match(/rotate\(([0-9]+)deg\)/),i=60,n=this.getAttribute("data-map-index");t&&(i=Number(t[1])+60)>=360&&(i-=360),this.style.transform="rotate("+i+"deg)",GPRandomizer.BoardState.map[2*n]=i}document.getElementById("setup").addEventListener("click",function(){d()}),document.getElementById("hide").addEventListener("click",function(){let e=document.getElementsByTagName("menu")[0],t=document.getElementById("mapGenMenu");e.style.display="none",t.style.display="none";var i=document.getElementsByTagName("main")[0].addEventListener("click",function(){e.style.display="block",t.style.display="block",document.getElementsByTagName("main")[0].removeEventListener("click",i)})}),document.getElementById("permalink").addEventListener("click",function(){let e=location.origin+location.pathname+GPRandomizer.BoardState.toHashbangString();window.history&&window.history.pushState(null,null,e),function(){let t=document.createElement("pre");t.style.display="inline-block",t.style.width=0,t.style.height=0,t.innerText=e,document.querySelector("div.header").appendChild(t);let i=document.createRange();i.selectNode(t),window.getSelection().addRange(i),document.execCommand("copy"),document.querySelector("div.header").removeChild(t),alert("Copy permalink to clipboard")}()}),document.getElementById("mapGen").addEventListener("click",function(){l(GPRandomizer.Menu.players())}),Array.prototype.forEach.call(document.querySelectorAll("div.mapItem > img"),function(e){e.addEventListener("click",u)});let m=null;window.addEventListener("resize",function(){clearTimeout(m),m=setTimeout(function(){GPRandomizer.Map.resizeMapVerticalGridLength()},300)}),d(!0)});