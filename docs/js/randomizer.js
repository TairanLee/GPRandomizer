/*! Copyright (c) Takuro Goto (sopra) | MIT License */
const GPRandomizer={};GPRandomizer.Menu={id:"pNumbers",players:function(e){return e&&e>1&&e<5&&(document.getElementById(this.id).value=e),document.getElementById(this.id).value}},GPRandomizer.BoardState={players:"",federation:"",advancedTechs:[],basicTechs:[],roundScores:[],finalScores:[],roundBoosters:[],map:[],toHashbangString:function(){return"#!PLAYERS="+this.players+"&FED="+this.federation+"&ADV="+this.advancedTechs.join(",")+"&BAS="+this.basicTechs.join(",")+"&RND="+this.roundScores.join(",")+"&FIN="+this.finalScores.join(",")+"&BOO="+this.roundBoosters.join(",")}},GPRandomizer.Board={},GPRandomizer.Board.Federation={},GPRandomizer.Map={boardId:"map",setPreset:function(e){},generatePresetMap:function(e){},generateRandomMap:function(e){},resizeMapVerticalGridLength:function(){let e=document.getElementById(this.boardId),t=e.clientWidth/20/2;e.style.gridTemplateRows=(t+"px ").repeat(30),e.style.setProperty("-ms-grid-rows",(t+"px").repeat(30))}},window.addEventListener("load",function(){const e=navigator.userAgent,t=e.match(/Chrome|Opera/)&&-1==e.indexOf("Edge")?".webp":"-min.png",i=["pic/FEDcre"+t,"pic/FEDknw"+t,"pic/FEDore"+t,"pic/FEDpwt"+t,"pic/FEDqic"+t,"pic/FEDvps"+t],n=["pic/RNDfed"+t,"pic/RNDgai3"+t,"pic/RNDgai4"+t,"pic/RNDmin"+t,"pic/RNDpia"+t,"pic/RNDstp"+t,"pic/RNDter"+t,"pic/RNDtrs3"+t,"pic/RNDtrs4"+t],r=["pic/TECcre"+t,"pic/TECgai"+t,"pic/TECknw"+t,"pic/TECore"+t,"pic/TECpia"+t,"pic/TECpow"+t,"pic/TECqic"+t,"pic/TECtyp"+t,"pic/TECvps"+t],a=["pic/ADVfedP"+t,"pic/ADVfedV"+t,"pic/ADVgai"+t,"pic/ADVknw"+t,"pic/ADVlab"+t,"pic/ADVminB"+t,"pic/ADVminV"+t,"pic/ADVore"+t,"pic/ADVqic"+t,"pic/ADVsecO"+t,"pic/ADVsecV"+t,"pic/ADVstp"+t,"pic/ADVtrsB"+t,"pic/ADVtrsV"+t,"pic/ADVtyp"+t],c=["pic/BOOgai"+t,"pic/BOOknw"+t,"pic/BOOlab"+t,"pic/BOOmin"+t,"pic/BOOnav"+t,"pic/BOOpia"+t,"pic/BOOpwt"+t,"pic/BOOqic"+t,"pic/BOOter"+t,"pic/BOOtrs"+t],o=["pic/FINbld"+t,"pic/FINfed"+t,"pic/FINgai"+t,"pic/FINsat"+t,"pic/FINsec"+t,"pic/FINtyp"+t],p={4:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t,"pic/9"+t,"pic/10"+t],3:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5"+t,"pic/6"+t,"pic/7"+t,"pic/8"+t],2:["pic/1"+t,"pic/2"+t,"pic/3"+t,"pic/4"+t,"pic/5_"+t,"pic/6_"+t,"pic/7_"+t]};function l(e,t){if(t&&t.length>0)return t.map(function(t){return e[t]});let i=[].concat(e);for(var n,r,a=i.length;a;)r=Math.floor(Math.random()*a--),n=i[a],i[a]=i[r],i[r]=n;return i}function d(e,t){!function(){if(!document.querySelector("[data-map-css]")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/map.css"),e.setAttribute("data-map-css",""),document.getElementsByTagName("head")[0].appendChild(e)}}(),GPRandomizer.Map.resizeMapVerticalGridLength();let i=l(p[e]);Array.prototype.forEach.call(document.querySelectorAll("[data-map]"),function(t,n){let r=t.parentElement;if(r.className="mapItem mapTile"+n+"-"+e+"er","none"==(r.currentStyle||document.defaultView.getComputedStyle(r,"")).display)return!0;let a=60*Math.floor(6*Math.random());t.setAttribute("src",i.shift()),t.style.transform="rotate("+a+"deg)"})}function s(e){var t,p,s={};1==e&&location.hash&&(s=function(e){for(var t=e.slice(e.indexOf("#!")+2).split("&"),i={},n=0;n<t.length;n++){var r=t[n].split("=");r.length>1?i[r[0]]=r[1]:i[r[0]]=null}return i}(location.hash)),s.PLAYERS&&GPRandomizer.Menu.players(s.PLAYERS),GPRandomizer.BoardState.players=GPRandomizer.Menu.players(),t=s.FED,p=0,p=t||Math.floor(Math.random()*i.length),document.getElementById("FED").setAttribute("src",i[p]),GPRandomizer.BoardState.federation=p,function(e){var t=e?e.split(","):[],i=l(a,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="adv"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.advancedTechs.push(a.indexOf(i[t]))})}(s.ADV),function(e){var t=e?e.split(","):[],i=l(r,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="bas"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.basicTechs.push(r.indexOf(i[t]))})}(s.BAS),function(e){let t=e?e.split(","):[],i=l(n,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="rnd"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.roundScores.push(n.indexOf(i[t]))})}(s.RND),function(e){let t=e?e.split(","):[],i=l(o,t);Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="fin"]'),function(e,t){e.setAttribute("src",i[t]),GPRandomizer.BoardState.finalScores.push(o.indexOf(i[t]))})}(s.FIN),function(e){let t=e?e.split(","):[],i=document.getElementById("booster"),n=Number(GPRandomizer.Menu.players()),r=n+3,a=l(c,t);i.style.setProperty("grid-template-columns","1fr ".repeat(r)),i.style.setProperty("-ms-grid-columns","1fr ".repeat(r)),Array.prototype.forEach.call(document.querySelectorAll('[data-generator-type="boo"]'),function(e,t){if(r<=t)return e.parentElement.style.display="none",!0;e.parentElement.style.setProperty("-ms-grid-column",t+1),e.parentElement.style.display="block",e.parentElement.className="booster booster"+n+"er",e.setAttribute("src",a[t]),GPRandomizer.BoardState.roundBoosters.push(c.indexOf(a[t]))})}(s.BOO),s.MAP&&d(GPRandomizer.Menu.players(),s.MAP)}function m(e){e.stopPropagation();let t=this.style.transform.match(/rotate\(([0-9]+)deg\)/),i=60;t&&(i=Number(t[1])+60)>=360&&(i-=360),this.style.transform="rotate("+i+"deg)"}document.getElementById("setup").addEventListener("click",function(){s()}),document.getElementById("hide").addEventListener("click",function(){let e=document.getElementsByTagName("menu")[0],t=document.getElementById("mapGenMenu");e.style.display="none",t.style.display="none";var i=document.getElementsByTagName("main")[0].addEventListener("click",function(){e.style.display="block",t.style.display="block",document.getElementsByTagName("main")[0].removeEventListener("click",i)})}),document.getElementById("permalink").addEventListener("click",function(){let e=location.origin+location.pathname+GPRandomizer.BoardState.toHashbangString();window.history&&window.history.pushState(null,null,e),function(){let t=document.createElement("pre");t.style.display="inline-block",t.style.width=0,t.style.height=0,t.innerText=e,document.querySelector("div.header").appendChild(t);let i=document.createRange();i.selectNode(t),window.getSelection().addRange(i),document.execCommand("copy"),document.querySelector("div.header").removeChild(t),alert("Copy permalink to clipboard")}()}),document.getElementById("mapGen").addEventListener("click",function(){d(GPRandomizer.Menu.players())}),Array.prototype.forEach.call(document.querySelectorAll("div.mapItem > img"),function(e){e.addEventListener("click",m)});let u=null;window.addEventListener("resize",function(){clearTimeout(u),u=setTimeout(function(){GPRandomizer.Map.resizeMapVerticalGridLength()},300)}),s(!0)});